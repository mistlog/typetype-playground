{"code":"/* link: https://github.com/mistlog/typetype-examples/tree/main/examples/url-parser */\r\n\r\n/**\r\n    eg.\r\n    type url = \"http://admin:123456@github.com:8080\"\r\n    type protocolRest = parseURL<url>['rest'];\r\n    type authorityRest = parseAuthority<protocolRest>[\"rest\"];\r\n\r\n    //\r\n    type protocol = parseURL<url>['protocol'];\r\n    type authority = parseAuthority<protocolRest>[\"authority\"];\r\n    type host = parseHost<authorityRest>;\r\n\r\n    checks([\r\n        check<protocol, {\r\n            protocol: \"http\";\r\n        }, Test.Pass>(),\r\n\r\n        check<authority, {\r\n            username: \"admin\";\r\n            password: \"123456\";\r\n        }, Test.Pass>(),\r\n\r\n        check<host, {\r\n            name: \"github.com\";\r\n            port: \"8080\";\r\n        }, Test.Pass>(),\r\n    ])\r\n */\r\nexport type function parseURL = (text) => ^{\r\n    if (parseProtocol<text> extends [infer protocol, infer rest]) {\r\n        return {\r\n            protocol,\r\n            rest\r\n        }\r\n    } else {\r\n        return never\r\n    }\r\n}\r\n\r\ntype function parseProtocol = (text) => ^{\r\n    if(text extends `${infer protocol}://${infer rest}`) {\r\n        return [\r\n            { protocol },\r\n            rest\r\n        ]\r\n    } else {\r\n        return never\r\n    }\r\n}\r\n\r\ntype function parseUserInfo = (text) => ^{\r\n    if(text extends `${infer username}:${infer password}`) {\r\n        return { username, password }\r\n    } else {\r\n        return { username: text }\r\n    }\r\n}\r\n\r\nexport type function parseAuthority = (text) => ^{\r\n    if(text extends `${infer authority}@${infer rest}`) {\r\n        return {\r\n            authority: parseUserInfo<authority>,\r\n            rest\r\n        }\r\n    } else { \r\n        return {\r\n            authority: null,\r\n            rest: text\r\n        }\r\n    }\r\n}\r\n\r\nexport type function parseHost = (text) => ^{\r\n    if(text extends `${infer name}:${infer port}`) {\r\n        return ^{\r\n            if(parsePort<port> extends never) {\r\n                return never\r\n            } else {\r\n                return { name, port }\r\n            }\r\n        }\r\n    } else {\r\n        return { name: text }\r\n    }\r\n}\r\n\r\ntype function parsePort = (text) => ^{\r\n    if(isNumberString<text> extends true) {\r\n        return text\r\n    } else {\r\n        return never\r\n    }\r\n}\r\n\r\ntype function isNumberString = (text) => ^{\r\n    if(text extends \"\") {\r\n        return never\r\n    } else {\r\n        return _isNumberString<text>\r\n    }\r\n}\r\n\r\ntype function _isNumberString = (text) => ^{\r\n    /* the end of recursion: each char of text is digit, no more chars to inspect */\r\n    if(text extends \"\") {\r\n        return true\r\n    } else if(text extends `${infer digit}${infer rest}`) {\r\n        return ^{\r\n            if(digit extends Digit) {\r\n                return _isNumberString<rest>\r\n            } else {\r\n                return false\r\n            }\r\n        }\r\n    } else {\r\n        return false\r\n    }\r\n}\r\n\r\ntype Digit = union [\"0\" , \"1\" , \"2\" , \"3\" , \"4\" , \"5\" , \"6\" , \"7\" , \"8\" , \"9\"]"}